<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Conor O'Neill">
    <meta name="description" content="Flash a new name on to your NodeConf EU 2018 badge">
    <title>NodeConf EU 2018 Badge Desktop Clock</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="//cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">
</head>

<body>
    <main class="wrapper">
        <div class="container">
            <div class="row">
                <div class="column">
                    <h1 class="title">NodeConf EU 2018 Badge Desktop Clock</h1>
                    <p> Any problems, just contact conor.oneill@nearform.com</p>
                    <p>You have 3 options for the badge on this page. <b>Pick one!</b></p>
                    <p>Follow these steps for the first 2 options:</p>
                    <ol>
                        <li>Turn on the badge whilst holding the bottom left hardware button to make it discoverable
                            over
                            Bluetooth.</li>
                        <li>Release hardware button when told on screen.</li>
                        <li>Click the relevant purple button below</li>
                        <li>In the popup that appears, first click "Web Bluetooth" and then click on your device, once
                            it is listed</li>
                        <li>Wait approx 30 seconds and it'll be done</li>
                    </ol>

                    <h2>Option 1 - Flash badge and permanently make it a clock</h2>
                    <p><b>IMPORTANT:</b> This will remove all the NodeConf User Apps and replace them with just the
                        clock.</p>

                    <form id="nameformflash">
                        <fieldset>
                            <input type="button" value="Flash Badge with Clock" onclick="flashDeskClock()">
                        </fieldset>
                    </form>

                    <h2>Or Option 2 - Update the time on an existing badge-clock</h2>
                    <p>If you power cycle the badge, it'll lose the time. This will send the time from your computer.</p>
                    <form id="timeform">
                        <fieldset>
                            <input type="button" value="Update Clock Time" onclick="timeDeskClock()">
                        </fieldset>
                    </form>
                    <h2>Or Option 3 - Re-flash a badge-clock back to stock NodeConf code</h2>
                    <p>If you previously chose Option 1 but now want to go back to the standard NodeConf code, do the
                        following:
                        <ol>
                            <li>Click <a href="https://www.espruino.com/ide/?codeurl=https://raw.githubusercontent.com/nearform/nceubadge2018/master/js/badge.js"
                                    target="_blank">this
                                    link</a> in Chrome to open the Web IDE in a new tab with the latest code
                                pre-loaded.
                            <li>Change
                                <em>"Nodeconf"</em> and
                                <em>"2018"</em> on line 3 to whatever you want displayed
                                as the name</li>
                            <li>Turn on the badge whilst holding the bottom left hardware button for 10 seconds to
                                erase all code and to make it discoverable over Bluetooth.</li>
                            <li>Change the "Save on Send" option in the Communications part of the Web IDE’s settings
                                to
                                "Direct To Flash (Execute code at boot)"</li>
                            <li>Click the Upload button</li>
                            <li>Once complete, after approx 30-60 seconds, return the "Save on Send" option in the
                                Communications part of the Web IDE’s settings to
                                "To RAM" so you don’t accidentally overwrite the code in the future.
                            </li>
                        </ol>

                    </p>

                    <script>
                        function flashDeskClock() {
                            var command = `function getLines(b,a,c){var d=Math.PI*a/2;switch(b){case'0':return[[a,0,1,0],[1,0,1,1],[1,1,1,2],[a,2,1,2],[a,1,a,2],[a,0,a,1]];case'1':return[[1-a,0,1,0],[1,0,1,1],[1-a,1,1,1],[1-a,1,1-a,2],[1-a,2,1,2]];case'2':return[[0,0,1,0],[1,0,1,1],[0,1,1,1],[0,1+a,0,2],[1,2-a,1,2],[0,2,1,2]];case'3':return[[0,0,1-a,0],[0,0,0,a],[1,0,1,1],[0,1,1,1],[1,1,1,2],[a,2,1,2]];case'4':return[[0,0,0,1],[1,0,1-a,0],[1,0,1,1-a],[0,1,1,1],[1,1,1,2],[1-a,2,1,2]];case'5':return c?[[0,0,0,1],[0,0,1,0],[a,1,1,1],[1,1,1,2],[0,2,1,2],[0,2,0,2],[1,1-a,1,1],[0,1,0,1+a]]:[[0,0,0,1],[0,0,1,0],[0,1,1,1],[1,1,1,2],[0,2,1,2],[0,2-a,0,2]];case'6':return[[0,0,0,1-a],[0,0,1,0],[a,1,1,1],[1,1-a,1,1],[1,1,1,2],[a,2,1,2],[0,1-a,0,2-2*a]];case'7':return[[0,0,0,a],[0,0,1,0],[1,0,1,1],[1-a,1,1,1],[1,1,1,2],[1-a,2,1,2],[1-a,1,1-a,2]];case'8':return[[0,0,0,1],[0,0,1,0],[1,0,1,1],[0,1,1,1],[1,1,1,2],[0,2,1,2],[0,1,0,2-a]];case'9':return[[0,0,0,1],[0,0,1,0],[1,0,1,1],[0,1,1-a,1],[0,1,0,1+a],[1,1,1,2],[0,2,1,2]];case':':return[[0.4,0.4,0.6,0.4],[0.6,0.4,0.6,0.6],[0.6,0.6,0.4,0.6],[0.4,0.4,0.4,0.6],[0.4,1.4,0.6,1.4],[0.6,1.4,0.6,1.6],[0.6,1.6,0.4,1.6],[0.4,1.4,0.4,1.6]];}return[];}function draw(k,n,m){var b=1;var c=10;var a=16;g.clear();for(var f=0;f<k.length;f++){var d=k[f];var e=n[f];var h,j=m;d!==undefined&&(e-1==d||e==0&&d==5||e==0&&d==9)?h=d:(h=e,j=0);var l=getLines(h,j,d==5&&e==0);h==':'&&(b-=4),l.forEach(function(d){d[0]!=d[2]?g.fillRect(b+d[0]*a,c+d[1]*a-1,b+d[2]*a,c+d[3]*a+1):d[1]!=d[3]&&g.fillRect(b+d[0]*a-1,c+d[1]*a,b+d[2]*a+1,c+d[3]*a);}),h==':'&&(b-=4),b+=22;}var i=new Date();g.setFont8x12(),g.setFontAlign(-1,-1),g.drawString(('0'+i.getSeconds()).substr(-2),b,c+2*a-8),g.setFontAlign(0,-1),g.drawString(i.toString().substr(0,15),g.getWidth()/2,c+2*a+4),g.flip();}function showTime(){if(animInterval)return;var d=new Date();var a=(' '+d.getHours()).substr(-2)+':'+('0'+d.getMinutes()).substr(-2);var c=lastTime;if(a==c){draw(a,c,0);return;}var b=0;animInterval=setInterval(function(){b+=0.0625,b>=1&&(b=1,clearInterval(animInterval),animInterval=0),draw(c,a,b);},50),lastTime=a;}function backlight(a){a||(a=new Uint8Array(12)),i2c.wl(7,a),i2c.wl(22,0);}function ledTop(a){a||(a=new Uint8Array(3)),i2c.wl(4,a),i2c.wl(22,0);}function ledBottom(a){a||(a=new Uint8Array(3)),i2c.wl(1,a),i2c.wl(22,0);}function onInit(){i2c.wl=function(a,b){this.writeTo(84,a,b);},i2c.setup({sda:A4,scl:A5}),D2.set(),i2c.wl(0,1),i2c.wl(19,[63,63,63]),backlight(backlightSettings[backlightIndex].concat(backlightSettings[backlightIndex],backlightSettings[backlightIndex],backlightSettings[backlightIndex])),ledTop(ledSettings[ledIndex]),ledBottom(ledSettings[ledIndex]),setWatch(function(){ledIndex=(ledIndex+1)%ledSettings.length,ledTop(ledSettings[ledIndex]),ledBottom(ledSettings[ledIndex]);},BTN1,{edge:'rising',debounce:50,repeat:!0}),setWatch(function(){backlightIndex=(backlightIndex+1)%backlightSettings.length,backlight(backlightSettings[backlightIndex].concat(backlightSettings[backlightIndex],backlightSettings[backlightIndex],backlightSettings[backlightIndex]));},BTN2,{edge:'rising',debounce:50,repeat:!0}),setWatch(function(){backlightIndex=backlightIndex==0&&backlightSettings.length-1||backlightIndex-1,backlight(backlightSettings[backlightIndex].concat(backlightSettings[backlightIndex],backlightSettings[backlightIndex],backlightSettings[backlightIndex]));},BTN3,{edge:'rising',debounce:50,repeat:!0}),setWatch(function(){ledIndex=ledIndex==0&&ledSettings.length-1||ledIndex-1,ledTop(ledSettings[ledIndex]),ledBottom(ledSettings[ledIndex]);},BTN4,{edge:'rising',debounce:50,repeat:!0}),setInterval(showTime,1000);}Modules.addCached('Font8x12',function(){var a=atob('AAAAAAAAAAfkAAwAAAwAAACQf8CQf8CQAAGIJEf+JEE4AAMMMQBgCMMMAAAYMkTEMkAYBkAAwAgAAAHwIIQEAAQEIIHwAABAFQDgBADgFQBABABAHwBABAAAACAMAABABABABABAAAAEAAAEAYAgDAEAYAAAP4QkRESEP4AAEEIEf8AEAAMMQUQUQkPEAAIIQEREREO4AABwCQEQIQf8AAeISESESER4AAH4KESESEB4AAYAQAQcTgcAAAO4REREREO4AAPAQkQkQoPwAACIAAACCMAABACgEQIIAACQCQCQCQCQAAIIEQCgBAAAMAQAQ0RAOAAAP4QETkUUUUP0AAP8RARARAP8AAf8REREREO4AAP4QEQEQEIIAAf8QEQEIIHwAAf8REREREQEAAf8RARARAQAAAP4QEQEREJ4AAf8BABABAf8AAQEf8QEAAAYAEQEf4QAAAf8BACgEQYMAAf8AEAEAEAEAAf8IAEACAEAIAf8AAf8EACABAf8AAP4QEQEQEP4AAf8RARARAOAAAP4QEQEQGP6AAf8RgRQRIOEAAOIREREREI4AAQAQAf8QAQAAAf4AEAEAEf4AAeABwAMBweAAAf8AIAQAgAQAIf8AAYMGwBAGwYMAAYAGAB8GAYAAAQMQ0REWEYEAAf8QEAAMACABgAQAMAAQEf8AAIAQAgAQAIAAAACACACACACAAgAwAAAAYCkCkCkB8AAf8CECECEB4AAB4CECECEBIAAB4CECECEf8AAB4CUCUCUBwAACAP8SAQAAAB4CFCFCFD+AAf8CACACAB8AACET8AEAAACABT+AAf8AgBQCIAEAAQEf8AEAAD8CACAD8CACAB8AAD8CACACAB8AAB4CECECEB4AAD/CECECEB4AAB4CECECED/AAD8BACACACAAABICkCkCkAYAACAP4CECEAAD4AEAEAED8AADAAwAMAwDAAAD4AEAEA4AEAED4AACMBQAgBQCMAAD4AFAFAFD+AACMCUCkDECEAABAO4QEQEAAf8AAQEQEO4BAAAYAgAQAQAIAwAAAAAAAAAAAAA'),b=atob('BQIEBgYGBwMEBAcGAwYCBwYFBgYGBgYGBgYCAwUGBQYHBgYGBgYGBgYEBgYGCAYGBgYGBgYGBggGBgYDBgMGBgMGBgYGBgUGBgQEBgQIBgYGBgYGBQYGCAYGBgUCBQcF');exports.add=function(c){c.prototype.setFont8x12=function(){this.setFontCustom(a,32,b,12);};};});var lastTime='00:00';var animInterval;require('Font8x12').add(Graphics);var i2c=new I2C();const backlightOptions={OFF:[0,0,0],DIM:[31,31,31],BRIGHT:[80,80,80],VERYBRIGHT:[127,127,127],PINK:[50,0,127],BLUE:[127,0,0]};const ledOptions={OFF:[0,0,0],DIMWHITE:[31,31,31],BRIGHTWHITE:[80,80,80],VERYBRIGHTWHITE:[127,127,127],DIMPINK:[12,0,31],BRIGHTPINK:[30,0,80],VERYBRIGHTPINK:[50,0,127],DIMBLUE:[31,0,0],BRIGHTBLUE:[80,0,0],VERYBRIGHTBLUE:[127,0,0]};const backlightSettings=[backlightOptions.OFF,backlightOptions.DIM,backlightOptions.BRIGHT,backlightOptions.VERYBRIGHT,backlightOptions.PINK,backlightOptions.BLUE];const ledSettings=[ledOptions.OFF,ledOptions.DIMWHITE,ledOptions.BRIGHTWHITE,ledOptions.VERYBRIGHTWHITE,ledOptions.DIMPINK,ledOptions.BRIGHTPINK,ledOptions.VERYBRIGHTPINK,ledOptions.DIMBLUE,ledOptions.BRIGHTBLUE,ledOptions.VERYBRIGHTBLUE];var backlightIndex=1;var ledIndex=1;`;
                            Puck.debug = 3;
                            Puck.write("\x03", function () {
                                console.log("Connected");
                                Puck.setTime(function () {
                                    console.log("Set Time");
                                    Puck.write('\x10require("Storage").eraseAll();\n', function () {
                                        Puck.write('\x10reset();\n', function () {
                                            setTimeout(function () {
                                                Puck.write("\x10E.setBootCode(" + JSON.stringify(command) + ")\n\x10load()\n", function () {
                                                    console.log("Code written");
                                                    setTimeout(function () { location.reload(); }, 10000);
                                                });
                                            }, 3000);
                                        });
                                    });
                                });
                            });
                        }
                    </script>
                    <script>
                        function timeDeskClock() {
                            Puck.write("\x03", function () {
                                console.log("Connected");
                                Puck.setTime(function () {
                                    console.log("Time Set");
                                    setTimeout(function () { location.reload(); }, 10000);
                                });
                            });
                        }
                    </script>
                </div>
            </div>
        </div>
    </main>
    <script src="https://www.puck-js.com/puck.js"></script>

</body>

</html>